<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "//www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="//www.w3.org/1999/xhtml" >
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>日梭万年历_万能查询网www.wncx.cn</title>
    <style type="text/css">
        <!--
        @import url("css/app.css?v=1");
        -->
    </style>
    <script src="js/ac.js" type="text/javascript"></script>
    <script src="js/cal.js" type="text/javascript"></script>
    <script src="js/pos.js" type="text/javascript"></script>
    <script src="js/jscale.js" type="text/javascript"></script>
    <script src="js/floatdiv.js" type="text/javascript"></script>
    <script src="js/combobox.js" type="text/javascript"></script>
    <script type="text/javascript">

        var app = {
                        currentPage:{year:0, month:0, day:0},
                        limits:{minYear:1901, maxYear:2050},
                        monthDays:[31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],
                        browser:{isie:undefined}
        };
        function initApp(){
            app.browser.isie = navigator.userAgent.indexOf("MSIE") >= 0;
            app.browser.isie6 = app.browser.isie && parseInt(navigator.userAgent.substr(navigator.userAgent.indexOf("MSIE") + 5)) == 6;
            initCombos();
            today();
            initTable();
        }
        function $(objid){
            return document.getElementById(objid);
        }

        function range(chkval, minval, maxval){
            if(!isNaN(minval)){
                if(chkval<minval) chkval = minval;
            }
            if(!isNaN(maxval)){
                if(chkval>maxval) chkval = maxval;
            }
            return chkval;
        }
        window.onmouseup = function(){
            window.$isDown=false;
        }
        window.onload = function(){
            initApp();
        }
        function next_year(){
            var m = app["currentPage"]["month"];
            var y = app["currentPage"]["year"];
            y += 1;
            setYearMonth(y, m);
        }
        function last_year(){
            var m = app["currentPage"]["month"];
            var y = app["currentPage"]["year"];
            y -= 1;
            setYearMonth(y, m);
        }
        function next_month(){
            var m = app["currentPage"]["month"];
            var y = app["currentPage"]["year"];
            m += 1;
            if(m > 12){ m -= 12; y += 1; }
            setYearMonth(y, m);
        }
        function last_month(){
            var m = app["currentPage"]["month"];
            var y = app["currentPage"]["year"];
            m -= 1;
            if(m < 1){ m += 12; y -= 1; }
            setYearMonth(y, m);
        }
        function today(){
            var d = new Date();
            setYearMonth(d.getFullYear(), d.getMonth() + 1, d.getDate());
        }
        function setYearMonth(year, month, day){
            year = parseInt(year);
            month = parseInt(month);
            if(day) day = parseInt(day);
            if(isNaN(year+month))return;
            if(year == app["currentPage"]["year"] && month == app["currentPage"]["month"] && day == app["currentPage"]["day"]) {
                return;
            }
            var ynl, ynr;
            if(year <= app.limits.minYear){
                ynl=true;
                $("year").className = "lrb nl";
            }else if(year >= app.limits.maxYear){
                ynr=true;
                $("year").className = "lrb nr";
            }else{
                $("year").className = "lrb";
            }
            if(month <= 1 && ynl){
                $("month").className = "lrb nl";
            }else if(month >=12 && ynr){
                $("month").className = "lrb nr";
            }else{
                $("month").className = "lrb";
            }
            app["currentPage"]["year"] = year;
            app["currentPage"]["month"] = month;
            app["currentPage"]["day"] = day || app["currentPage"]["day"];
            if($("c_year").innerText === undefined){
                $("c_year").innerHTML = year + "年";
                $("c_month").innerHTML = month + "月";
            }else{
                $("c_year").innerText = year + "年";
                $("c_month").innerText = month + "月";
            }
            setCalendarTable(year, month, day);
            if(year && app.dls.ipt_year.value != year.toString()){
                app.dls.ipt_year.choose(year.toString(),year.toString());
            }
            if(month && app.dls.ipt_month.value != month.toString()){
                app.dls.ipt_month.choose(month.toString(),month.toString());
            }
            if(day && app.dls.ipt_day.value != day.toString()){
                app.dls.ipt_day.choose(day.toString(),day.toString());
            }
        }

        function elemOffset(elem)
        {
             var t = elem.offsetTop;  
             var l = elem.offsetLeft;  
             while( elem = elem.offsetParent) 
             {  
                  t += elem.offsetTop;  
                  l += elem.offsetLeft;  
             }
             return { x : l , y : t };
        }
function getElementLeft(element){
　　　　var actualLeft = element.offsetLeft;
　　　　var current = element.offsetParent;
　　　　while (current !== null){
　　　　　　actualLeft += current.offsetLeft;
　　　　　　current = current.offsetParent;
　　　　}
　　　　return actualLeft;
　　}
function getElementTop(element){
　　　　var actualTop = element.offsetTop;
　　　　var current = element.offsetParent;
　　　　while (current !== null){
　　　　　　actualTop += current.offsetTop;
　　　　　　current = current.offsetParent;
　　　　}
　　　　return actualTop;
}

    function clearCalendarTable(){
        FloatDiv.clear();
        var ctb = document.getElementById("weektitle");
        for(var n = ctb.nextSibling; n;){
            var tn = n.nextSibling;
            n.parentNode.removeChild(n);
            n = tn;
        }
    }
    function setCalendarTable(year, month, day){

        //var ft = new Date().getTime();
        if(month>12) {month-=12;year+=1;}
        if(month<1) {month+=12;year-=1;}
        var ctb = document.getElementById("calendartablebody");
        day = day || app.currentPage.day;
        if(year.toString()+month.toString() == ctb.getAttribute("yearmonth")){
            if(day == ctb.getAttribute("day")){
                return;
            }else{
                var md = new Date(year, month - 1, 1);
                var fd = md.getDay();
                var tds = ctb.getElementsByTagName("td");
                for(var ti = 0; ti < tds.length; ti++){
                    if(tds[ti].className.indexOf("checked") >=0){
                        tds[ti].className=tds[ti].className.replace(/\s*checked\s*/g, " ");
                        break;
                    }
                }
                tds[day - 1 + fd].className += " checked";
                ctb.setAttribute("day", day.toString());
                return;
            }
        }else{
            ctb.setAttribute("yearmonth", year.toString() + month.toString());
            ctb.setAttribute("day", day.toString());
        }
        clearCalendarTable();
        var cm = month;
        var cy = year;
        var ds = app.monthDays[cm - 1];
        if(cm == 2) if(isleap(cy)) ds+=1;
        var md = new Date(cy, cm - 1, 1);
        var tr = document.createElement("tr");
        ctb.appendChild(tr);
        //var te = ctb.parentNode;
        //te.removeChild(ctb);
        //var hahaha = [];
        var last_month = cm - 1;
        var last_month_days = app.monthDays[(last_month + 11) % 12] + (last_month == 2?isleap(year)?1:0:0);
        var bp = elemOffset($("maincale"));
        var cd = new Lunar(new Date(year, month-1, day));
        $("chineseyear").innerHTML = cyclical(cd.year-1900+36) + "年·" + Animals[(cd.year-4)%12] + "年";
        
        for(var i=0, unchk=true, fd=0; i < 7 * 6; i++){
            //hahaha.push(new Date().getTime() - ft);
            var td = document.createElement("td");
            tr.appendChild(td);
            if(unchk){
                if(i>=md.getDay()){ unchk = false; fd = i; }
            }
            if(i%7==0 || i%7==6){
                td.className = "weekend";
            }
            if(i%7==0){
                td.className += " no-left-line";
            }
            
            if(!unchk){
                if(i - fd + 1 <= ds) {
                    var datespan = document.createElement("span");
                    datespan.className="date";
                    datespan.appendChild(document.createTextNode(i - fd + 1));
                    td.appendChild(datespan);
                    var splunar=document.createElement("span");
                    splunar.className="cndate";
                    td.appendChild(splunar);
                    var l = new Lunar(new Date(year, month-1, i-fd+1));
                    var t1 = ((month + 11)%12) * 2 , t2 = t1 + 1;
                    if(i - fd + 1 == sTerm(year, t1)){
                        splunar.innerHTML=solarTerm[t1];
                    }else if(i-fd+1 == sTerm(year, t2)){
                        splunar.innerHTML=solarTerm[t2];
                    }else{
                        if(l.day == 1) splunar.innerHTML="正二三四五六七八九十冬腊".substr(l.month-1,1) + "月" + (l.isLeap?"闰":"");
                        else splunar.innerHTML=cDay(l.day);
                    }
                    var fst_word = getFestv(new Date(year, month-1, i-fd+1), l);
                    var eo = elemOffset(td);
                    if(fst_word){
                        var tfw = fst_word.split(/\|/g);
                        fst_word = "";
                        for(var tfwi = 0; tfwi < tfw.length; tfwi++){
                            fst_word += (fst_word?"<strong>|</strong>":"") + "<span>" + tfw[tfwi] + "</span>";
                        }
                        
                        new FloatDiv($("main-container")).setWidth(td.offsetWidth-8).setHeight(18).setText(fst_word, true).setPointer("50%", "-6").setPosition(eo.y - bp.y + td.offsetHeight/2 + 16,null,null,eo.x - bp.x + td.offsetWidth/2 + 1).eventMouseOver(function(e){this.active().autoSize().bringToFront();}).eventMouseOut(function(e){this.deactive().fixedSize();});
                    }
                    td.style.cursor="pointer";
                    td.onclick = (function(d, ldate){
                        return function(){
                            app.dls.ipt_day.choose(d, d);
                            app.dls.ipt_month.choose(cm, cm);
                            app.dls.ipt_year.choose(cy, cy);
                            $("chineseyear").innerHTML = cyclical(cy-1900+36) + "年·" + Animals[(cy-4)%12] + "年";

                            var tds = ctb.getElementsByTagName("td");
                            for(var ti = 0; ti < tds.length; ti++){
                                if(tds[ti].className.indexOf("checked") >=0){
                                    tds[ti].className=tds[ti].className.replace(/\s*checked\s*/g, " ");
                                    break;
                                }
                            }
                            tds[d - 1 + fd].className += " checked";
                        }
                    })(i-fd+1, l);
                    if(day && i - fd + 1 == day){
                        td.className += " checked";
                    }
                    td.onmouseover = function(d){
                        this.className += " hover";
                    };
                    td.onmouseout = function(){
                        this.className = this.className.replace(/\s*hover\s*/g, " ");
                    };
                }else{
                    td.className += " not-this-month";
                    var datespan = document.createElement("span");
                    datespan.className = "date";
                    datespan.appendChild(document.createTextNode(i - fd - ds + 1));
                    td.appendChild(datespan);
                }
            }else{
                td.className += " not-this-month";
                var datespan = document.createElement("span");
                datespan.className = "date";
                datespan.appendChild(document.createTextNode(last_month_days - (md.getDay() - i) + 1));
                td.appendChild(datespan);
            }
            if(i%7==6 && i < 7*6-1){
                tr = document.createElement("tr");
                tr.className = "top-line";
                ctb.appendChild(tr);
            };
        }
        //alert(hahaha);
        //te.appendChild(ctb);
    }
    function calc_res(){

        if(!app.dls.ipt_day.value || !app.dls.ipt_month.value || !app.dls.ipt_year.value) {
            /*alert("请选择年月日，或在万年历上直接点选");*/
            return;
        }
        if(!$("ipt_long").value || !$("ipt_lat").value){
            /*alert("请选择地点，或手动输入地理坐标");*/
            return;
        }
        var d=parseInt(app.dls.ipt_day.value),
            m=parseInt(app.dls.ipt_month.value),
            y=parseInt(app.dls.ipt_year.value),
            z=parseInt(document.getElementById("zone").value),
            lo=parseFloat(document.getElementById("ipt_long").value),
            la=parseFloat(document.getElementById("ipt_lat").value);

        var obj = Cal(mjd(d,m,y,0.0), z, lo, la);
        var ret = "";
        if(obj["rise"] == undefined){
            ret = "太阳不升";
        }else{
            ret = "日出时间:<span><strong>" + obj["rise"] + "</strong> (北京时间)</span>";
            if(obj["set"] == undefined){
                ret += "太阳不落";
            }else{
                ret += "日落时间:<span class='nr'><strong>" + obj["set"] + "</strong> (北京时间)</span>";
            }
        }
        
        document.getElementById("result-display").innerHTML = ret;

    };
    function initTable(){
        var cdate = new Date();

        var provselect = window.prov;
        var posselect = window.posite;
        posselect.onchange = function(){
            var resobj=calc(posselect.value);
            document.getElementById("ipt_long").value=getmin(resobj.x).value.toString().substr(0,8);
            document.getElementById("ipt_lat").value=getmin(resobj.y).value.toString().substr(0,8);
            calc_res();
        }
        provselect.onchange = function(){
            posselect.clear();
            for(var tpos in addrinfo[provselect.value]){
                posselect.add(new ComboBoxItem(tpos, addrinfo[provselect.value][tpos]));
            }
            posselect.choose(posselect.options[0].value, posselect.options[0].text);
            posselect.onchange();
        }
        for(var taddr in addrinfo){
            provselect.add(new ComboBoxItem(taddr,taddr));
        }
        provselect.choose(provselect.options[0].value, provselect.options[0].text);
        provselect.onchange();

        document.getElementById("calc-button").onclick = calc_res;
        document.getElementById("calc-button").disabled = "";

        var nd=new Date();
        ipt_year.choose(nd.getFullYear().toString(), nd.getFullYear().toString());
        ipt_month.choose((nd.getMonth()+1).toString(), (nd.getMonth()+1).toString());
        ipt_day.choose(nd.getDate().toString(), nd.getDate().toString());
    }
    function initCombos(){
        app.dls={
            "ipt_year":new ComboBox("ipt_year", $("cnt_year")),
            "ipt_month":new ComboBox("ipt_month", $("cnt_month")),
            "ipt_day":new ComboBox("ipt_day", $("cnt_day")),
            "prov":new ComboBox("prov", $("cnt_prov")),
            "posite":new ComboBox("posite", $("cnt_posite"))
        };
        
        window.ipt_year = app.dls.ipt_year;
        window.ipt_month = app.dls.ipt_month;
        window.ipt_day = app.dls.ipt_day;
        window.prov = app.dls.prov;
        window.posite = app.dls.posite;
        for(var t = app.limits.minYear; t<=app.limits.maxYear; t++)
            app.dls.ipt_year.add(new ComboBoxItem(t.toString(), t.toString()));
        for(var t = 1; t <= 12; t++)
            app.dls.ipt_month.add(new ComboBoxItem(t.toString(), t.toString()));
        for(var t = 1; t <= 31; t++)
            app.dls.ipt_day.add(new ComboBoxItem(t.toString(), t.toString()));
        app.dls.ipt_year.onchange = app.dls.ipt_month.onchange = app.dls.ipt_day.onchange = function(){
            if(this != app.dls.ipt_day){
                var tv = parseInt(app.dls.ipt_day.value);
                app.dls.ipt_day.clear();
                var cy = parseInt(app.dls.ipt_year.value);
                var cm = parseInt(app.dls.ipt_month.value);
                var ds = app.monthDays[cm - 1];
                if(cm == 2) if(isleap(cy)) ds+=1;
                for(var t = 1; t <= ds; t++){
                    app.dls.ipt_day.add(new ComboBoxItem(t.toString(), t.toString()));
                }
                tv = range(tv, 1, ds);
                app.dls.ipt_day.choose(tv.toString(),tv.toString());
            }
            setYearMonth(app.dls.ipt_year.value, app.dls.ipt_month.value, app.dls.ipt_day.value);
            calc_res();
        }
    }
    </script>
</head>
<body  topmargin="0" leftmargin="0" style="BACKGROUND-COLOR: transparent">
    <div id="main-container">
        <div id="maincale">
            <div id="caleheader">
                <a id="today" href="javascript:today();">今天</a>
                <span id="year" class="lrb">
                    <a href="javascript:last_year()" class="lbtn"></a>
                    <span id="c_year"></span>
                    <a href="javascript:next_year()" class="rbtn"></a>
                </span>
                <span id="month" class="lrb">
                    <a href="javascript:last_month()" class="lbtn"></a>
                    <span id="c_month"></span>
                    <a href="javascript:next_month()" class="rbtn"></a>
                </span>
                <span id="chineseyear"></span>
                <div class="clear" style="height:1px"></div>
            </div>
            <div id="calebody">
                <table id="calendartable" cellpadding="0" cellspacing="0">
                    <caption id="calendartitle"></caption>
                    <tbody id="calendartablebody">
                        <tr id="weektitle"><th class="no-left-line">日</th><th>一</th><th>
							二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr>
                    </tbody>
                </table>
            </div>
            <div id="query">
                <div class="ctnr">
                    <input type="hidden" id="zone" value="8" />
                    <!--input type="text" id="ipt_year" class="dl_s" /-->
                    <div id="cnt_year" class="dl_s" style="position:absolute;top:15px;left:15px;z-index:99;"></div>
                    <label for="ipt_year" style="position:absolute;top:18px;left:84px;">
					年</label>
                    <!--input type="text" id="ipt_month" class="dl_s"/-->
                    <div id="cnt_month" class="dl_s" style="position:absolute;top:15px;left:101px;z-index:99;"></div>
                    <label for="ipt_month" style="position:absolute;top:18px;left:157px;">
					月</label>
                    <!--input type="text" id="ipt_day" class="dl_s"/-->
                    <div id="cnt_day" class="dl_s" style="position:absolute;top:15px;left:174px;z-index:99;"></div>
                    <label for="ipt_day" style="position:absolute;top:18px;left:230px;">
					日，</label>
                    <div id="cnt_prov" class="dl_s" style="position:absolute;top:15px;left:264px;z-index:99;"></div>
                    <label for="prov" style="position:absolute;top:18px;left:344px;">
					地区</label>
                    <div id="cnt_posite" class="dl_s" style="position:absolute;top:15px;left:376px;z-index:99;"></div>
                    <div class="clear16"></div>
                    <label for="ipt_long" style="position:absolute;top:57px;left:15px;">
					经度：</label>
                    <input type="text" id="ipt_long" class="lo_la" maxlength="8" style="position:absolute;top:54px;left:55px;" onblur="this.editing=true;if(isNaN(parseFloat(this.value))) this.value='0';else this.value=range(parseFloat(this.value),-180,180);this.editing=false;calc_res();" onchange="calc_res();"/>
                    <label for="ipt_lat" style="position:absolute;top:57px;left:139px;">
					纬度：</label>
                    <input type="text" id="ipt_lat" class="lo_la" maxlength="8" style="position:absolute;top:54px;left:179px;" onblur="this.editing=true;if(isNaN(parseFloat(this.value))) this.value='0';else this.value=range(parseFloat(this.value),-90,90);this.editing=false;calc_res();" onchange="calc_res();"/>
                    <!--select id="prov" class="dl_s"></select>
                    <select id="posite" class="dl_s"></select-->
                    <input type="button" id="calc-button" value="查询日出日落时间" onblur="window.$isDown=false;this.className='';"
                        onmousedown="window.$isDown=true;this.className='down';" onmouseup="window.$isDown=false;this.className='';" 
                        onmouseout="this.className='';" onmouseover="if(window.$isDown)this.className='down';" style="position:absolute;top:44px;left:356px;display:none;"/>
                    <div class="clear16"></div>
                    <table id="result" cellspacing="0" style="position:absolute;top:88px;left:15px;">
                        <tbody>
                            <tr>
                                <th>日出日落时间：</th>
                                <td id="result-display"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

